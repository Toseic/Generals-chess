<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <style>
        body {
          text-align: center;
          background-color: rgb(29, 29, 29);
        }
  
        .chessboard {
            height: 700px;
            width: 700px;
            display: inline-block;
            /* text-align: center; */
            background-color: rgb(29, 29, 29);

        }
        table {
            background-color: rgb(29, 29, 29);
        }
  
        td {
            
            background-color:rgb(220, 220, 220);
            font-size :12px;
            text-overflow: ellipsis;
            color: white;
            border-radius: 0px;
            border: 0.7px solid rgb(29, 29, 29);
            
            line-height: 25px;
            height: 25px;
            width: 25px;
            padding: 0px;
            font-weight: 500;
            text-align: center;

            background-size:22px 22px;
            /* -moz-background-size:100% 100%; */
            white-space: nowrap;

            /* position: relative;
            border: 1.5px solid black;
            width: 25px;
            height: 25px;
            background: #dcdcdc;
            text-align: center;
            color: white;
            text-shadow: 0 0 1px black;
            opacity: 1;
            padding: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 12px;
            background-size:100% 100%; */

        }
        .city {
            background-image: url("./img/city.png");
            background-color: gray;
            background-position: center center;
            background-repeat: no-repeat;
            border: 1px solid rgba(0, 0, 0, 0);

        }
        .mountain {
            background-image: url("./img/mountain.png");
            background-color: rgb(187, 187, 187);
            background-position: center center;
            background-repeat: no-repeat;
            border: 0.7px solid rgb(29, 29, 29);
            /* color: #ffffff00; */
        }
        .mountain.fog {
            background-image: url("./img/mountain.png");
            background-color: rgba(255,255,255,0.1);
            background-position: center center;
            background-repeat: no-repeat;
            border: 1px solid rgba(29, 29, 29, 0);
            /* color: #ffffff00; */
        }
        .general {
            background-image: url("./img/crown.png");
            background-position: center center;
            background-repeat: no-repeat;

        }
        .square {
            background-position: center center;
        }
        .chosd {
            border-color: rgb(75, 247, 176);
        }
        .fog {
            color:#ffffff00;
            border: 1px solid rgba(29, 29, 29, 0);
            background-color: rgba(255,255,255,0.1)
        }
        .from {
          border-color: aquamarine;
        }
  
        .to {
          border-color: brown;
        }
  
        .from.to {
          border-color: chocolate;
        }
  
        .red {
          /* color: red; */
          background-color: red;
        }
  
        .blue {
          color: #0033aa;
          background-color: #aaddff;
        }
  
        .neutral {
          color: #332a1b;
          background-color: #eceffa;
        }
  
        .fortress {
          -webkit-text-stroke: 1px rgba(0, 0, 0, 0.5);
        }
  
        .blue.fortress {
          color: #002299;
          background-color: #77bbff;
        }
  
        .red.fortress {
          color: #771100;
          background-color: #ea9;
        }
  
        .base {
          font-size: 20px;
          box-shadow: 0 0 4px 0px chartreuse;
        }

        .neutral.fortress {
          color: #210;
          background-color: #ccc;
        }
  
        .obstacle {
          background-color: #962;
        }
  
        .draw,
        .winning {
          font-size: 40px;
        }
  
        .draw {
          color: #333;
        }
  
        .redwin {
          color: crimson;
        }
  
        .bluewin {
          color: dodgerblue;
        }
  
        .neutralw {
          color: #333;
        }

        #city {
            background-image: url("./img/city.png");
        }
      </style>
  </head>

  <body>
    <div class="winning">
      <span id="redName" class="redwin"></span> vs
      <span id="blueName" class="bluewin"></span>
    </div>
    <div class="scoreBoard">
      兵力
      <span id="redScore" class="redwin"></span>
      :
      <span id="blueScore" class="bluewin"></span>
      :
      <span id="neutrScore" class="neutralw"></span>
    </div>
    <div class="squareBoard">
      领土面积
      <span id="redArea" class="redwin"></span>
      :
      <span id="blueArea" class="bluewin"></span>
    </div>
    <div>
      <table class="chessboard" id="chessDisplay" cellpadding="10px" cellspacing="0px"></table>
    </div>
    <div id="message"></div>

    <script src="/javascripts/jquery-2.1.0.min.js"></script>
    <script src="player_api.js"></script>
    <script>
        class cell {
            constructor(x,y,n1=0,n2=-1) {
                this.__count = n1;
                this.__type = n2;
                this.__element = document.createElement("td");
                // this.__element.id = "city";
                // this.addClass("city");
                this.focusOn=function() {  
                    this.addClass("chosd");
                } 
                // style change TODO:
                this.__element.addEventListener("click", (e) => {
                    game.refreshChosd(x,y);
                });
            }
            get type() {
                return this.__type;
            }
            get count() {
                return this.__count;
            }
            get element() {
                return this.__element;
            }
            set type(x) { 
                switch(x) {
                    case -1:
                        break;
                    case 0:
                        break;
                    case 1:
                        this.addClass("mountain");                        
                        break;
                    case 2:
                        this.addClass("city");
                    case 3: case 4: 
                        this.addClass(belonglist[1-x%2]);
                        this.delClass(belonglist[x%2]);                    
                    case 5: case 6: 
                        this.addClass("city");
                        this.addClass(belonglist[1-x%2]);
                        this.delClass(belonglist[x%2]);
                    case 7: case 8:
                        this.addClass("general");
                        this.addClass(belonglist[1-x%2]);
                        this.delClass(belonglist[x%2]);
                        break;
                    default:
                        throw 'error type';

                }                    
            }

            
            addClass(x) {
                if (!this.__element.classList.contains(x))
                    this.__element.classList.add(x);
            }
            delClass(x) {
                if (this.__element.classList.contains(x))
                    this.__element.classList.remove(x);
            }
            set num(x) {
                if (x!=0)
                    this.__element.innerHTML = x.toString();
            }
            get num() {
                return this.__element.innerHTML ;
            }
            setfog = function (bol) {
                if (bol==0 || bol == false) {
                    this.delClass("fog");
                } else {
                    this.addClass("fog");
                }
            }
            // set type(x) {
            //     this.del(belonglist[1-x]);
            //     this.add(belonglist[x]);
            // }

        }
        // var initData = infoProvider.getMatchInitData();
        // var height = initData.height;
        // var width = initData.width;
        var height = 16;
        var width = 16;
        var game ={};
        const type2str = {
            "-1" : "unknown",
            "0" : "freeSquare",
            "1" : "mountain",
            "2": "freeCity",
            "3":"user1Square",
            "4":"user2Square",
            "5":"user1City",
            "6":"user2City",
            "7":"user1Generals",
            "8":"user2Generals",
        };
        const belonglist = ["red","blue"];
        game.map = [];
        game.chsdAction = [-1,-1,-1];
        game.refreshChosd = function(x,y) {
            if (x<0 || y<0 || x>=height || y>width) 
                throw "error coord";
            if (this.chsdAction[0] == -1 ){
                console.log("-1");
                console.log(this.chsdAction[0]);
            }
            else {
                this.map[this.chsdAction[0]][this.chsdAction[1]].delClass("chosd");
            }
            this.chsdAction = [x,y,this.map[x][y].__count-1];
            this.map[x][y].addClass("chosd");
        }
        
        for (let i = 0;i<height;++i) {
            let er = [];
            let line = document.createElement("tr");
            for (let j = 0; j < width; ++j) {
                let c = new cell(i, j);
                er.push(c);
                line.appendChild(c.element);
            }
            game.map.push(er);
            document.getElementById("chessDisplay").appendChild(line);
        }
        // infoProvider.setSize(700, 700);
        function displayHandler(cb) {
            if (cb.status !== "end") {
                for (let i = 0; i < height; ++i) {
                    for (let j = 0; j < width; ++j) {
                        game.map[i][j].num = cb.map[0][i][j];
                        game.map[i][j].type = cb.map[1][i][j];
                        game.map[i][j].setfog(cb.fog[i][j])
                    }                    
                }

            }

        }

        var cb = { "fog": [ [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1] ], "map": [ [ [-1, -1, -1, -1, 0, -1, 0, -1, -1, -1, -1, 0, -1, 0, 0, 0], [0, -1, -1, -1, 0, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1], [-1, -1, 0, -1, -1, 0, -1, 0, -1, -1, -1, 0, -1, 0, -1, -1], [-1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, -1, -1, -1, 0, -1, -1, -1, 0, -1, -1, 0, -1, -1, -1, -1], [0, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1], [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, 0, -1, 0, -1, -1], [0, -1, 0, -1, 0, -1, 0, -1, -1, -1, -1, -1, 0, -1, -1, -1], [-1, -1, 0, -1, -1, -1, 0, 0, -1, -1, -1, -1, 0, -1, -1, 0], [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1], [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1], [0, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, 0, -1], [-1, 0, 0, -1, -1, -1, -1, 0, -1, 0, 0, 0, 0, -1, -1, 0], [-1, -1, 0, -1, 0, -1, -1, -1, 0, 0, 4, 0, -1, -1, -1, -1], [-1, 0, -1, -1, 0, -1, -1, -1, -1, 0, 0, 0, -1, -1, -1, -1] ], [ [-1, -1, -1, -1, 1, -1, 1, -1, -1, -1, -1, 1, -1, 1, 1, 1], [1, -1, -1, -1, 1, -1, -1, -1, -1, 1, -1, -1, -1, -1, -1, -1], [-1, -1, 1, -1, -1, 1, -1, 1, -1, -1, -1, 1, -1, 1, -1, -1], [-1, -1, -1, -1, -1, -1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, -1, -1, -1], [1, -1, -1, -1, -1, 1, -1, -1, -1, -1, -1, 1, -1, -1, -1, -1], [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, -1, -1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, 1, -1, -1], [1, -1, 1, -1, 1, -1, 1, -1, -1, -1, -1, -1, 1, -1, -1, -1], [-1, -1, 1, -1, -1, -1, 1, 1, -1, -1, -1, -1, 1, -1, -1, 1], [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1], [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1], [1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1], [-1, 1, 1, -1, -1, -1, -1, 1, -1, 0, 0, 0, 1, -1, -1, 1], [-1, -1, 1, -1, 1, -1, -1, -1, 1, 0, 7, 0, -1, -1, -1, -1], [-1, 1, -1, -1, 1, -1, -1, -1, -1, 0, 0, 1, -1, -1, -1, -1] ] ], "status": "opening" };
        displayHandler(cb);
        
    </script>
  </body>
</html>
